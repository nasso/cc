let sync = require("libsync")

print("testing empty wait group...")
let wg = sync.waitGroup.new()
wg.wait()

print("testing synchronous wait group...")
let wg = sync.waitGroup.new()
wg.add(1)
wg.done()
wg.wait()
let wg = sync.waitGroup.new()
wg.add(3)
wg.done()
wg.done()
wg.done()
wg.wait()
let wg = sync.waitGroup.new()
wg.add(3)
wg.add(-3)
wg.wait()

print("testing asynchronous wait group...")
let wg = sync.waitGroup.new()
wg.add(3)
run fn() { wg.done() }()
run fn() { wg.done() }()
run fn() { wg.done() }()
wg.wait()

let wg = sync.waitGroup.new()
wg.add(3)
run fn() { wg.add(-2) }()
run fn() { wg.done() }()
wg.wait()

print("waitGroup tests passed")
